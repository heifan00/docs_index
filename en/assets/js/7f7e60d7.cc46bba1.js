"use strict";(self.webpackChunkhif_icu=self.webpackChunkhif_icu||[]).push([[4399],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>g});var i=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=i.createContext({}),m=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=m(e.components);return i.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},s=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=m(t),s=a,g=u["".concat(l,".").concat(s)]||u[s]||d[s]||o;return t?i.createElement(g,r(r({ref:n},c),{},{components:t})):i.createElement(g,r({ref:n},c))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=s;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p[u]="string"==typeof e?e:a,r[1]=p;for(var m=2;m<o;m++)r[m]=t[m];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}s.displayName="MDXCreateElement"},3798:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>m});var i=t(7462),a=(t(7294),t(3905));const o={title:"AopDemo",tags:["aop"],categories:["Java"],date:new Date("2021-12-20T20:21:34.000Z"),urlname:"aopdemo",top:null,slug:"/aop"},r=void 0,p={unversionedId:"\u539f\u535a\u5ba2\u6587\u4ef6/AopDemo",id:"\u539f\u535a\u5ba2\u6587\u4ef6/AopDemo",title:"AopDemo",description:"\u7406\u8bba\u57fa\u7840",source:"@site/docs/\u539f\u535a\u5ba2\u6587\u4ef6/AopDemo.md",sourceDirName:"\u539f\u535a\u5ba2\u6587\u4ef6",slug:"/aop",permalink:"/en/aop",draft:!1,tags:[{label:"aop",permalink:"/en/tags/aop"}],version:"current",frontMatter:{title:"AopDemo",tags:["aop"],categories:["Java"],date:"2021-12-20T20:21:34.000Z",urlname:"aopdemo",top:null,slug:"/aop"},sidebar:"tutorialSidebar",previous:{title:"\u539f\u535a\u5ba2\u6587\u4ef6",permalink:"/en/category/\u539f\u535a\u5ba2\u6587\u4ef6"},next:{title:"Git\u5f00\u53d1\u6d41\u7a0b\u89c4\u8303",permalink:"/en/\u539f\u535a\u5ba2\u6587\u4ef6/Git\u5f00\u53d1\u6d41\u7a0b\u89c4\u8303"}},l={},m=[{value:"\u7406\u8bba\u57fa\u7840",id:"\u7406\u8bba\u57fa\u7840",level:3},{value:"\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u6b65\u9aa4",id:"\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u6b65\u9aa4",level:3},{value:"Aop\u76f8\u5173\u6ce8\u89e3",id:"aop\u76f8\u5173\u6ce8\u89e3",level:3}],c={toc:m},u="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(u,(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h3",{id:"\u7406\u8bba\u57fa\u7840"},"\u7406\u8bba\u57fa\u7840"),(0,a.kt)("p",null,"\u7b80\u5355\u5730\u53bb\u7406\u89e3\uff0c\u5176\u5b9eAOP\u8981\u505a\u4e09\u7c7b\u4e8b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5728\u54ea\u91cc\u5207\u5165\uff0c\u4e5f\u5c31\u662f\u6743\u9650\u6821\u9a8c\u7b49\u975e\u4e1a\u52a1\u64cd\u4f5c\u5728\u54ea\u4e9b\u4e1a\u52a1\u4ee3\u7801\u4e2d\u6267\u884c\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5728\u4ec0\u4e48\u65f6\u5019\u5207\u5165\uff0c\u662f\u4e1a\u52a1\u4ee3\u7801\u6267\u884c\u524d\u8fd8\u662f\u6267\u884c\u540e\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5207\u5165\u540e\u505a\u4ec0\u4e48\u4e8b\uff0c\u6bd4\u5982\u505a\u6743\u9650\u6821\u9a8c\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u3002")),(0,a.kt)("p",null,"\u56e0\u6b64\uff0cAOP\u7684\u4f53\u7cfb\u53ef\u4ee5\u68b3\u7406\u4e3a\u4e0b\u56fe\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fq_70%2Cc_zoom%2Cw_640%2Fimages%2F20171110%2F9ae24140b59b41ce841cff0c3595500f.jpeg&refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642596825&t=9923d715b52cb64b8189b7860db78632",alt:"image-20210617093001113"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Pointcut"),"\uff1a\u5207\u70b9\uff0c\u51b3\u5b9a\u5904\u7406\u5982\u6743\u9650\u6821\u9a8c\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u5728\u4f55\u5904\u5207\u5165\u4e1a\u52a1\u4ee3\u7801\u4e2d\uff08\u5373\u7ec7\u5165\u5207\u9762\uff09\u3002\u5207\u70b9\u5206\u4e3a",(0,a.kt)("inlineCode",{parentName:"li"},"execution"),"\u65b9\u5f0f\u548c",(0,a.kt)("inlineCode",{parentName:"li"},"annotation"),"\u65b9\u5f0f\u3002\u524d\u8005\u53ef\u4ee5\u7528\u8def\u5f84\u8868\u8fbe\u5f0f\u6307\u5b9a\u54ea\u4e9b\u7c7b\u7ec7\u5165\u5207\u9762\uff0c\u540e\u8005\u53ef\u4ee5\u6307\u5b9a\u88ab\u54ea\u4e9b\u6ce8\u89e3\u4fee\u9970\u7684\u4ee3\u7801\u7ec7\u5165\u5207\u9762\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Advice"),"\uff1a\u5904\u7406\uff0c\u5305\u62ec\u5904\u7406\u65f6\u673a\u548c\u5904\u7406\u5185\u5bb9\u3002\u5904\u7406\u5185\u5bb9\u5c31\u662f\u8981\u505a\u4ec0\u4e48\u4e8b\uff0c\u6bd4\u5982\u6821\u9a8c\u6743\u9650\u548c\u8bb0\u5f55\u65e5\u5fd7\u3002\u5904\u7406\u65f6\u673a\u5c31\u662f\u5728\u4ec0\u4e48\u65f6\u673a\u6267\u884c\u5904\u7406\u5185\u5bb9\uff0c\u5206\u4e3a\u524d\u7f6e\u5904\u7406\uff08\u5373\u4e1a\u52a1\u4ee3\u7801\u6267\u884c\u524d\uff09\u3001\u540e\u7f6e\u5904\u7406\uff08\u4e1a\u52a1\u4ee3\u7801\u6267\u884c\u540e\uff09\u7b49\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Aspect"),"\uff1a\u5207\u9762\uff0c\u5373",(0,a.kt)("inlineCode",{parentName:"li"},"Pointcut"),"\u548c",(0,a.kt)("inlineCode",{parentName:"li"},"Advice"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Joint point"),"\uff1a\u8fde\u63a5\u70b9\uff0c\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u4e00\u4e2a\u70b9\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u65b9\u6cd5\u7684\u6267\u884c\u6216\u8005\u4e00\u4e2a\u5f02\u5e38\u7684\u5904\u7406\u3002\u5728 Spring AOP \u4e2d\uff0c\u4e00\u4e2a\u8fde\u63a5\u70b9\u603b\u662f\u4ee3\u8868\u4e00\u4e2a\u65b9\u6cd5\u6267\u884c\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Weaving"),"\uff1a\u7ec7\u5165\uff0c\u5c31\u662f\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\uff0c\u5728\u76ee\u6807\u5bf9\u8c61\u65b9\u6cd5\u4e2d\u6267\u884c\u5904\u7406\u5185\u5bb9\u7684\u8fc7\u7a0b\u3002")),(0,a.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u6b65\u9aa4"},"\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u6b65\u9aa4"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"@Target\u3001@Retention\u3001@Documented"),"\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6ce8\u89e3\uff1a"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * @author HiF\n */\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface PermissionsAnnotation {\n}\n")),(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"\u521b\u5efa\u7b2c\u4e00\u4e2aAOP\u5207\u9762\u7c7b\uff0c\u53ea\u8981\u5728\u7c7b\u4e0a\u52a0\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"@Aspect")," \u6ce8\u89e3\u5373\u53ef\u3002",(0,a.kt)("inlineCode",{parentName:"li"},"@Aspect")," \u6ce8\u89e3\u7528\u6765\u63cf\u8ff0\u4e00\u4e2a\u5207\u9762\u7c7b\uff0c\u5b9a\u4e49\u5207\u9762\u7c7b\u7684\u65f6\u5019\u9700\u8981\u6253\u4e0a\u8fd9\u4e2a\u6ce8\u89e3\u3002",(0,a.kt)("inlineCode",{parentName:"li"},"@Component")," \u6ce8\u89e3\u5c06\u8be5\u7c7b\u4ea4\u7ed9 Spring \u6765\u7ba1\u7406\u3002")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'import com.alibaba.fastjson.JSON;\nimport com.alibaba.fastjson.JSONObject;\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Pointcut;\nimport org.springframework.core.annotation.Order;\nimport org.springframework.stereotype.Component;\n\n@Aspect\n@Component\n@Order(8)\npublic class PermissionFirstAdvice {\n    /**\n     * \u5b9a\u4e49\u4e00\u4e2a\u5207\u9762\uff0c\u62ec\u53f7\u5185\u5199\u5165\u7b2c\u4e00\u6b65\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u8def\u5f84\n     */\n    @Pointcut("@annotation(com.lff.demo.annotation.PermissionsAnnotation)")\n    private void permissionCheck(){}\n\n    @Around("permissionCheck()")\n    public Object permissionCheckFirst(ProceedingJoinPoint joinPoint) throws Throwable {\n        System.out.println("======\u7b2c\u4e00\u4e2a\u5207\u9762======");\n\n        // \u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\n        Object[] objects = joinPoint.getArgs();\n        Long id = ((JSONObject) objects[0]).getLong("id");\n        String name = ((JSONObject) objects[0]).getString("name");\n        System.out.println("id1->>>>>>>>>>>>>>>>>>>>>>" + id);\n        System.out.println("name1->>>>>>>>>>>>>>>>>>>>>>" + name);\n\n        // id\u5c0f\u4e8e0\u629b\u51fa\u975e\u6cd5id\u5f02\u5e38\n        if (id < 0) {\n            return JSON.parseObject("{\\"message\\":\\"illegal id\\",\\"code\\":403}");\n        }\n        return joinPoint.proceed();\n    }\n}\n')),(0,a.kt)("ol",{parentName:"li",start:3},(0,a.kt)("li",{parentName:"ol"},"\u521b\u5efa\u63a5\u53e3\u7c7b\uff0c\u8fd0\u884c\u6d4b\u8bd5\u3002")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'import com.alibaba.fastjson.JSONObject;\nimport com.lff.demo.annotation.PermissionsAnnotation;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author HiF\n */\n@RestController\n@RequestMapping(value = "/permission")\npublic class PermissionController {\n\n    @RequestMapping("/check")\n    @PermissionsAnnotation\n    public JSONObject getGroupList(@RequestBody JSONObject request){\n        return JSONObject.parseObject("{\\"message\\":\\"SUCCESS\\",\\"code\\":200},\\"data\\":" + request + "}");\n    }\n}\n')))),(0,a.kt)("h3",{id:"aop\u76f8\u5173\u6ce8\u89e3"},"Aop\u76f8\u5173\u6ce8\u89e3"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@Pointcut")," \u6ce8\u89e3\uff0c\u7528\u6765\u5b9a\u4e49\u4e00\u4e2a\u5207\u9762\uff0c\u5373\u4e0a\u6587\u4e2d\u6240\u5173\u6ce8\u7684\u67d0\u4ef6\u4e8b\u60c5\u7684\u5165\u53e3\uff0c\u5207\u5165\u70b9\u5b9a\u4e49\u4e86\u4e8b\u4ef6\u89e6\u53d1\u65f6\u673a\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public class LogAspectHandler {\n\n    @Pointcut("execution(* com.lff.demo.controller..*.*(..))")\n    private void logAdvicePointcut(){}\n}\n')),(0,a.kt)("p",{parentName:"li"},"@Pointcut \u6ce8\u89e3\u6307\u5b9a\u4e00\u4e2a\u5207\u9762\uff0c\u5b9a\u4e49\u9700\u8981\u62e6\u622a\u7684\u4e1c\u897f\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e24\u4e2a\u5e38\u7528\u7684\u8868\u8fbe\u5f0f\uff1a\u4e00\u4e2a\u662f\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"execution()"),"\uff0c\u53e6\u4e00\u4e2a\u662f\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"annotation()"),"\u3002"),(0,a.kt)("p",{parentName:"li"},"\u66f4\u591a\u53c2\u8003\uff1a",(0,a.kt)("a",{parentName:"p",href:"http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247488811&idx=2&sn=0d054027651bef114ae6bec5a8f62359&chksm=ebd62a07dca1a3111269692dd9b0a5ab8af7d2038b8ec6600a057573364e76db1332adc5fd46&scene=21#wechat_redirect"},"SpringBoot\u5185\u5bb9\u805a\u5408")),(0,a.kt)("p",{parentName:"li"},"execution\u8868\u8fbe\u5f0f\uff1a"),(0,a.kt)("p",{parentName:"li"},"\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"execution(* * com.mutest.controller..*.*(..)))")," \u8868\u8fbe\u5f0f\u4e3a\u4f8b\uff1a"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u4e2a ",(0,a.kt)("em",{parentName:"li"}," \u53f7\u7684\u4f4d\u7f6e\uff1a\u8868\u793a\u8fd4\u56de\u503c\u7c7b\u578b\uff0c")," \u8868\u793a\u6240\u6709\u7c7b\u578b\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5305\u540d\uff1a\u8868\u793a\u9700\u8981\u62e6\u622a\u7684\u5305\u540d\uff0c\u540e\u9762\u7684\u4e24\u4e2a\u53e5\u70b9\u8868\u793a\u5f53\u524d\u5305\u548c\u5f53\u524d\u5305\u7684\u6240\u6709\u5b50\u5305\uff0c\u5728\u672c\u4f8b\u4e2d\u6307 com.mutest.controller\u5305\u3001\u5b50\u5305\u4e0b\u6240\u6709\u7c7b\u7684\u65b9\u6cd5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u4e2a ",(0,a.kt)("em",{parentName:"li"}," \u53f7\u7684\u4f4d\u7f6e\uff1a\u8868\u793a\u7c7b\u540d\uff0c")," \u8868\u793a\u6240\u6709\u7c7b\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"(..)\uff1a\u8fd9\u4e2a\u661f\u53f7\u8868\u793a\u65b9\u6cd5\u540d\uff0c")," \u8868\u793a\u6240\u6709\u7684\u65b9\u6cd5\uff0c\u540e\u9762\u62ec\u5f27\u91cc\u9762\u8868\u793a\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u53e5\u70b9\u8868\u793a\u4efb\u4f55\u53c2\u6570\u3002")),(0,a.kt)("p",{parentName:"li"},"annotation() \u8868\u8fbe\u5f0f\uff1a"),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"annotation()")," \u65b9\u5f0f\u662f\u9488\u5bf9\u67d0\u4e2a\u6ce8\u89e3\u6765\u5b9a\u4e49\u5207\u9762\uff0c\u6bd4\u5982\u6211\u4eec\u5bf9\u5177\u6709 @PostMapping \u6ce8\u89e3\u7684\u65b9\u6cd5\u505a\u5207\u9762\uff0c\u53ef\u4ee5\u5982\u4e0b\u5b9a\u4e49\u5207\u9762\uff1a"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Pointcut("@annotation(org.springframework.web.bind.annotation.PostMapping)")\npublic void annotationPointcut() {}\n')),(0,a.kt)("p",{parentName:"li"},"\u7136\u540e\u4f7f\u7528\u8be5\u5207\u9762\u7684\u8bdd\uff0c\u5c31\u4f1a\u5207\u5165\u6ce8\u89e3\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"@PostMapping")," \u7684\u6240\u6709\u65b9\u6cd5\u3002\u8fd9\u79cd\u65b9\u5f0f\u5f88\u9002\u5408\u5904\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"@GetMapping\u3001@PostMapping\u3001@DeleteMapping"),"\u4e0d\u540c\u6ce8\u89e3\u6709\u5404\u79cd\u7279\u5b9a\u5904\u7406\u903b\u8f91\u7684\u573a\u666f\u3002"),(0,a.kt)("p",{parentName:"li"},"\u8fd8\u6709\u5c31\u662f\u5982\u4e0a\u9762\u6848\u4f8b\u6240\u793a\uff0c\u9488\u5bf9\u81ea\u5b9a\u4e49\u6ce8\u89e3\u6765\u5b9a\u4e49\u5207\u9762\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'/**\n     * \u5b9a\u4e49\u4e00\u4e2a\u5207\u9762\uff0c\u62ec\u53f7\u5185\u5199\u5165\u7b2c\u4e00\u6b65\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u8def\u5f84\n     */\n    @Pointcut("@annotation(com.lff.demo.annotation.PermissionsAnnotation)")\n    private void permissionCheck(){}\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@Around"),"\u6ce8\u89e3\u7528\u4e8e\u4fee\u9970",(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u589e\u5f3a\u5904\u7406\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u589e\u5f3a\u5904\u7406\u975e\u5e38\u5f3a\u5927\uff0c\u8868\u73b0\u5728\uff1a"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"@Around"),"\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u589e\u5f3a\u52a8\u4f5c\u4e0e\u76ee\u6807\u65b9\u6cd5\u7684\u6267\u884c\u987a\u5e8f\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u5728\u589e\u5f3a\u52a8\u4f5c\u524d\u540e\uff0c\u751a\u81f3\u8fc7\u7a0b\u4e2d\u6267\u884c\u76ee\u6807\u65b9\u6cd5\u3002\u8fd9\u4e2a\u7279\u6027\u7684\u5b9e\u73b0\u5728\u4e8e\uff0c\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"ProceedingJoinPoint"),"\u53c2\u6570\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"procedd()"),"\u65b9\u6cd5\u624d\u4f1a\u6267\u884c\u76ee\u6807\u65b9\u6cd5\u3002"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"@Around"),"\u53ef\u4ee5\u6539\u53d8\u6267\u884c\u76ee\u6807\u65b9\u6cd5\u7684\u53c2\u6570\u503c\uff0c\u4e5f\u53ef\u4ee5\u6539\u53d8\u6267\u884c\u76ee\u6807\u65b9\u6cd5\u4e4b\u540e\u7684\u8fd4\u56de\u503c\u3002")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u589e\u5f3a\u5904\u7406\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u5f53\u5b9a\u4e49\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"li"},"Around"),"\u589e\u5f3a\u5904\u7406\u65b9\u6cd5\u65f6\uff0c\u8be5\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u5f62\u53c2\u5fc5\u987b\u662f ",(0,a.kt)("inlineCode",{parentName:"li"},"ProceedingJoinPoint")," \u7c7b\u578b\uff08\u81f3\u5c11\u4e00\u4e2a\u5f62\u53c2\uff09\u3002\u5728\u589e\u5f3a\u5904\u7406\u65b9\u6cd5\u4f53\u5185\uff0c\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"ProceedingJoinPoint"),"\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"proceed"),"\u65b9\u6cd5\u624d\u4f1a\u6267\u884c\u76ee\u6807\u65b9\u6cd5\uff1a\u8fd9\u5c31\u662f",(0,a.kt)("inlineCode",{parentName:"li"},"@Around"),"\u589e\u5f3a\u5904\u7406\u53ef\u4ee5\u5b8c\u5168\u63a7\u5236\u76ee\u6807\u65b9\u6cd5\u6267\u884c\u65f6\u673a\u3001\u5982\u4f55\u6267\u884c\u7684\u5173\u952e\uff1b\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"ProceedingJoinPoint"),"\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"proceed"),"\u65b9\u6cd5\uff0c\u5219\u76ee\u6807\u65b9\u6cd5\u4e0d\u4f1a\u6267\u884c\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"ProceedingJoinPoint"),"\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"proceed"),"\u65b9\u6cd5\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"li"},"Object[ ]"),"\u5bf9\u8c61\uff0c\u8be5\u6570\u7ec4\u4e2d\u7684\u503c\u5c06\u88ab\u4f20\u5165\u76ee\u6807\u65b9\u6cd5\u4f5c\u4e3a\u5b9e\u53c2\u2014\u2014\u8fd9\u5c31\u662f",(0,a.kt)("inlineCode",{parentName:"li"},"Around"),"\u589e\u5f3a\u5904\u7406\u65b9\u6cd5\u53ef\u4ee5\u6539\u53d8\u76ee\u6807\u65b9\u6cd5\u53c2\u6570\u503c\u7684\u5173\u952e\u3002\u8fd9\u5c31\u662f\u5982\u679c\u4f20\u5165\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"Object[ ]"),"\u6570\u7ec4\u957f\u5ea6\u4e0e\u76ee\u6807\u65b9\u6cd5\u6240\u9700\u8981\u7684\u53c2\u6570\u4e2a\u6570\u4e0d\u76f8\u7b49\uff0c\u6216\u8005",(0,a.kt)("inlineCode",{parentName:"li"},"Object[ ]"),"\u6570\u7ec4\u5143\u7d20\u4e0e\u76ee\u6807\u65b9\u6cd5\u6240\u9700\u53c2\u6570\u7684\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u7a0b\u5e8f\u5c31\u4f1a\u51fa\u73b0\u5f02\u5e38\u3002")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@Around"),"\u529f\u80fd\u867d\u7136\u5f3a\u5927\uff0c\u4f46\u901a\u5e38\u9700\u8981\u5728\u7ebf\u7a0b\u5b89\u5168\u7684\u73af\u5883\u4e0b\u4f7f\u7528\u3002\u56e0\u6b64\uff0c\u5982\u679c\u4f7f\u7528\u666e\u901a\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"Before"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"AfterReturning"),"\u5c31\u80fd\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u5c31\u6ca1\u6709\u5fc5\u8981\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u4e86\u3002\u5982\u679c\u9700\u8981\u76ee\u6807\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u548c\u4e4b\u540e\u5171\u4eab\u67d0\u79cd\u72b6\u6001\u6570\u636e\uff0c\u5219\u5e94\u8be5\u8003\u8651\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u3002\u5c24\u5176\u662f\u9700\u8981\u4f7f\u7528\u589e\u5f3a\u5904\u7406\u963b\u6b62\u76ee\u6807\u7684\u6267\u884c\uff0c\u6216\u9700\u8981\u6539\u53d8\u76ee\u6807\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u65f6\uff0c\u5219\u53ea\u80fd\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"Around"),"\u589e\u5f3a\u5904\u7406\u4e86\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@Before")," \u6ce8\u89e3\u6307\u5b9a\u7684\u65b9\u6cd5\u5728\u5207\u9762\u5207\u5165\u76ee\u6807\u65b9\u6cd5\u4e4b\u524d\u6267\u884c\uff0c\u53ef\u4ee5\u505a\u4e00\u4e9b ",(0,a.kt)("inlineCode",{parentName:"p"},"Log")," \u5904\u7406\uff0c\u4e5f\u53ef\u4ee5\u505a\u4e00\u4e9b\u4fe1\u606f\u7684\u7edf\u8ba1\uff0c\u6bd4\u5982\u83b7\u53d6\u7528\u6237\u7684\u8bf7\u6c42 ",(0,a.kt)("inlineCode",{parentName:"p"},"URL")," \u4ee5\u53ca\u7528\u6237\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"IP")," \u5730\u5740\u7b49\u7b49\uff0c\u8fd9\u4e2a\u5728\u505a\u4e2a\u4eba\u7ad9\u70b9\u7684\u65f6\u5019\u90fd\u80fd\u7528\u5f97\u5230\uff0c\u90fd\u662f\u5e38\u7528\u7684\u65b9\u6cd5\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @author HiF\n */\n@Aspect\n@Component\n@Slf4j\n@Order(7)\npublic class LogAspectHandler {\n\n    @Pointcut("execution(* com.lff.demo.controller..*.*(..))")\n    private void logAdvicePointcut(){}\n\n    /**\n     * \u5728\u4e0a\u9762\u5b9a\u4e49\u7684\u5207\u9762\u65b9\u6cd5\u4e4b\u524d\u6267\u884c\u8be5\u65b9\u6cd5\n     */\n\n    @Before("logAdvicePointcut()")\n    public void doBefore(JoinPoint joinPoint){\n        log.info("====doBefore====");\n\n        // \u83b7\u53d6\u7b7e\u540d\n        Signature signature = joinPoint.getSignature();\n\n        // \u83b7\u53d6\u5207\u5165\u70b9\u7684\u62a5\u540d\n        String declaringTypeName = signature.getDeclaringTypeName();\n\n        // \u83b7\u53d6\u5373\u5c06\u6267\u884c\u7684\u65b9\u6cd5\u540d\n        String name = signature.getName();\n        log.info("\u5373\u5c06\u6267\u884c\u7684\u65b9\u6cd5\uff1a{},\u5c5e\u4e8e\uff1a{}\u5305",name,declaringTypeName);\n\n        // \u4e5f\u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982\u8bf7\u6c42\u7684url\u548cip\n        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();\n        HttpServletRequest request = requestAttributes.getRequest();\n\n        // \u83b7\u53d6\u8bf7\u6c42URL\n        String url = request.getRequestURL().toString();\n\n        //\u83b7\u53d6\u8bf7\u6c42IP\n        String ip = request.getRemoteAddr();\n        log.info("\u7528\u6237\u8bf7\u6c42\u7684url\u4e3a\uff1a{}\uff0cip\u5730\u5740\u4e3a\uff1a{}", url, ip);\n    }\n}\n')),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"JointPoint")," \u5bf9\u8c61\u5f88\u6709\u7528\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u83b7\u53d6\u4e00\u4e2a\u7b7e\u540d\uff0c\u5229\u7528\u7b7e\u540d\u53ef\u4ee5\u83b7\u53d6\u8bf7\u6c42\u7684\u5305\u540d\u3001\u65b9\u6cd5\u540d\uff0c\u5305\u62ec\u53c2\u6570\uff08\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"joinPoint.getArgs()")," \u83b7\u53d6\uff09\u7b49\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@After")," \u6ce8\u89e3\u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"@Before")," \u6ce8\u89e3\u76f8\u5bf9\u5e94\uff0c\u6307\u5b9a\u7684\u65b9\u6cd5\u5728\u5207\u9762\u5207\u5165\u76ee\u6807\u65b9\u6cd5\u4e4b\u540e\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u505a\u4e00\u4e9b\u5b8c\u6210\u67d0\u65b9\u6cd5\u4e4b\u540e\u7684 Log \u5904\u7406\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},' @Pointcut("execution(* com.lff.demo.controller..*.*(..))")\n    private void logAdvicePointcut(){}\n\n  /**\n     * \u5728\u4e0a\u9762\u5b9a\u4e49\u7684\u5207\u9762\u65b9\u6cd5\u4e4b\u540e\u6267\u884c\u8be5\u65b9\u6cd5\n     * @param joinPoint jointPoint\n     */\n@After("logAdvicePointcut()")\n    public void doAfter(JoinPoint joinPoint) {\n        log.info("==== doAfter \u65b9\u6cd5\u8fdb\u5165\u4e86====");\n        Signature signature = joinPoint.getSignature();\n        String method = signature.getName();\n        log.info("\u65b9\u6cd5{}\u5df2\u7ecf\u6267\u884c\u5b8c", method);\n    }\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"@AfterReturning")," \u6ce8\u89e3\u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"@After")," \u6709\u4e9b\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"@AfterReturning")," \u6ce8\u89e3\u53ef\u4ee5\u7528\u6765\u6355\u83b7\u5207\u5165\u65b9\u6cd5\u6267\u884c\u5b8c\u4e4b\u540e\u7684\u8fd4\u56de\u503c\uff0c\u5bf9\u8fd4\u56de\u503c\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u4e0a\u7684\u589e\u5f3a\u5904\u7406\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Pointcut("execution(* com.lff.demo.controller..*.*(..))")\n    private void logAdvicePointcut(){}\n\n@AfterReturning(pointcut = "logAdvicePointcut()",returning = "result")\n    public void doAfterReturning(JoinPoint joinPoint,Object result){\n        Signature signature = joinPoint.getSignature();\n        String classMethod = signature.getName();\n        log.info("\u65b9\u6cd5{}\u6267\u884c\u5b8c\u6bd5,\u8fd4\u56de\u53c2\u6570\u4e3a\uff1a{}",classMethod,result);\n\n        // \u5b9e\u9645\u9879\u76ee\u4e2d\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u505a\u5177\u4f53\u7684\u8fd4\u56de\u503c\u589e\u5f3a\n        log.info("\u5bf9\u8fd4\u56de\u53c2\u6570\u8fdb\u884c\u4e1a\u52a1\u4e0a\u7684\u589e\u5f3a\uff1a{}",result+"\u589e\u5f3a\u7248");\n    }\n')),(0,a.kt)("p",{parentName:"li"},"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"@AfterReturning")," \u6ce8\u89e3 \u4e2d\uff0c\u5c5e\u6027 ",(0,a.kt)("inlineCode",{parentName:"p"},"returning")," \u7684\u503c\u5fc5\u987b\u8981\u548c\u53c2\u6570\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u68c0\u6d4b\u4e0d\u5230\u3002\u8be5\u65b9\u6cd5\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u5165\u53c2\u5c31\u662f\u88ab\u5207\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"doAfterReturning")," \u65b9\u6cd5\u4e2d\u53ef\u4ee5\u5bf9\u8fd4\u56de\u503c\u8fdb\u884c\u589e\u5f3a\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u8981\u505a\u76f8\u5e94\u7684\u5c01\u88c5\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5f53\u88ab\u5207\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\u65f6\uff0c\u4f1a\u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"@AfterThrowing")," \u6ce8\u89e3\u7684\u65b9\u6cd5\u4e2d\u6267\u884c\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u505a\u4e00\u4e9b\u5f02\u5e38\u7684\u5904\u7406\u903b\u8f91\u3002\u8981\u6ce8\u610f\u7684\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"throwing")," \u5c5e\u6027\u7684\u503c\u5fc5\u987b\u8981\u548c\u53c2\u6570\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002\u8be5\u65b9\u6cd5\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u5165\u53c2\u5373\u4e3a\u629b\u51fa\u7684\u5f02\u5e38\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Pointcut("execution(* com.lff.demo.controller..*.*(..))")\n    private void logAdvicePointcut(){}\n\n@AfterThrowing(pointcut = "logAdvicePointcut()",throwing = "ex")\n    public void afterThrowing(JoinPoint joinPoint,Throwable ex){\n        Signature signature = joinPoint.getSignature();\n        String method = signature.getName();\n\n        // \u5904\u7406\u5f02\u5e38\u7684\u903b\u8f91\n        log.info("\u6267\u884c\u65b9\u6cd5{}\u51fa\u9519\uff0c\u5f02\u5e38\u4e3a:{}",method,ex);\n    }\n')))))}d.isMDXComponent=!0}}]);