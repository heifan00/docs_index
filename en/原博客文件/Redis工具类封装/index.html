<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-原博客文件/Redis工具类封装">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Redis工具类封装 | HiF.icu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hif.icu/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hif.icu/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hif.icu/en/原博客文件/Redis工具类封装"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Redis工具类封装 | HiF.icu"><meta data-rh="true" name="description" content="摘要"><meta data-rh="true" property="og:description" content="摘要"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hif.icu/en/原博客文件/Redis工具类封装"><link data-rh="true" rel="alternate" href="https://hif.icu/原博客文件/Redis工具类封装" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://hif.icu/en/原博客文件/Redis工具类封装" hreflang="en"><link data-rh="true" rel="alternate" href="https://hif.icu/原博客文件/Redis工具类封装" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YC0RIRDJGZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="HiF.icu" href="/en/opensearch.xml"><link rel="stylesheet" href="/en/assets/css/styles.fe8a7a32.css">
<link rel="preload" href="/en/assets/js/runtime~main.e32c180a.js" as="script">
<link rel="preload" href="/en/assets/js/main.3f548347.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HiF</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/">Docs</a><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/">嘿凡的文档空间</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/category/杂乱问题">杂乱问题</a><button aria-label="Toggle the collapsible sidebar category &#x27;杂乱问题&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/category/原博客文件">原博客文件</a><button aria-label="Toggle the collapsible sidebar category &#x27;原博客文件&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/aop">AopDemo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/Git开发流程规范">Git开发流程规范</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/Hutool工具类之validator字段验证器">HuTool工具类</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/JJWT框架的使用">JJWT框架的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/Java运行命令解析">Java运行命令解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/LeetCode-53. 最大子序和">最大子序和_力扣53</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/LeetCode-94. 二叉树的中序遍历">二叉树的中序遍历</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/Linux常用命令">Linux常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/MySQL导出注释信息">MySQL导出注释信息</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/MySQL索引">MySQL索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/原博客文件/Redis工具类封装">Redis工具类封装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/ThreadLocal">ThreadLocal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/gateway总结">GateWay总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/saas应用管理文档">SaaS应用管理文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/【重点】应用开发过程中的注意事项">应用开发过程中的注意事项</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/企业微信群机器人发送消息">企业微信群机器人发送消息</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/基础数据管理之版本管理模块-数据版本">基础数据管理之版本管理模块-数据版本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/应该抵制的品牌">应该抵制的品牌</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/数据库单表实现多级子树">数据库单表实现多级子树</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/数据库存储小技巧">数据库存储技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/网址收藏">网址收藏</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/记一次HuTool树操作">记一次HuTool树操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/记一次Java后端处理前端拖拽排序">记一次后端处理前端拖拽排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/记一次低码平台问题排查">记一次低码平台问题排查</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/原博客文件/设计模式-工厂模式">设计模式-工厂模式</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/category/原博客文件"><span itemprop="name">原博客文件</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Redis工具类封装</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Redis工具类封装</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="摘要">摘要<a href="#摘要" class="hash-link" aria-label="Direct link to 摘要" title="Direct link to 摘要">​</a></h3><ul><li>该工具类是大佬在20年编写的</li><li>我在使用过程中发现少了hMGet方法</li><li>所以就照葫芦画瓢，写了hMGet方法</li><li>不使用RedisTemplate封装的方法是因为不想用（大佬说有bug）</li><li>自己封装，用起来岂不是更牛逼？</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="难点">难点<a href="#难点" class="hash-link" aria-label="Direct link to 难点" title="Direct link to 难点">​</a></h3><ul><li>序列化</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码">代码<a href="#代码" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-rediscacheservicei">1. RedisCacheServiceI<a href="#1-rediscacheservicei" class="hash-link" aria-label="Direct link to 1. RedisCacheServiceI" title="Direct link to 1. RedisCacheServiceI">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.domain.Search;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.utils.SortTypeEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.connection.RedisZSetCommands;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Set;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.TimeUnit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ****.coding@gmail.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2020-08-31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface RedisCacheServiceI {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 查找所有符合给定模式 pattern 的 key ， 比如说：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * KEYS * 匹配数据库中所有 key 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * KEYS h*llo 匹配 hllo 和 heeeeello 等。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 特殊符号用 \ 隔开。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * {@link = http://redisdoc.com/database/keys.html}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 时间复杂度： O(N)， N 为数据库中 key 的数量。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;String&gt; keys(String pattern);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 检查key是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * {@link = http://redisdoc.com/database/exists.html}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 时间复杂度： O(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean exists(String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 设置过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param redisKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param expire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param timeUnit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean expire(String redisKey, long expire, TimeUnit timeUnit);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 设置过期的字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean setStr(String key, String value, Long timeout);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 设置value自增数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long increment(String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 设置不过期的字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean setStr(String key, String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取字符串key的value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String getStr(String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取字符串key的value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param clazz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param &lt;T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T&gt; T getStr(String key, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param clazz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param &lt;T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param &lt;R&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T, R&gt; List&lt;T&gt; mGet(List&lt;R&gt; list, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 根据key删除缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long del(String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 判断member是否在set中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean sIsMember(String key, String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取set 中的元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long sCard(String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * set 新增value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean sAdd(String key, String values);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * set 移除value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean sRem(String key, String values);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * hmSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void hSet(String key, Map m);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean hSet(final String key, final String field, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean hExists(final String key, final String field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T&gt; T hGet(String key, String hashKey, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * hget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param hashKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object hGet(String key, String hashKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 批量获取HASH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @Author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @Date 2021/6/25 16:38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T&gt; List&lt;T&gt; hMGet(String key, List&lt;String&gt; fields, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boolean zAdd(final String key, final double score, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zAdd(final String key, Set&lt;RedisZSetCommands.Tuple&gt; tuples);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Double zScore(final String key, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Double zIncrBy(final String key, final double increment, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zCard(final String key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zCount(final String key, final RedisZSetCommands.Range range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T&gt; Set&lt;T&gt; zRange(final String key, final long start, final long end, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRange(final String key, final long start, final long end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRevRange(final String key, final long start, final long end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRangeByScore(final String key, final double min, final double max);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;RedisZSetCommands.Tuple&gt; zRangeWithScores(final String key, final long start, final long end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;RedisZSetCommands.Tuple&gt; zRevRangeWithScores(final String key, final long start, final long end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRevRangeByScore(final String key, final double min, final double max);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRevRangeByScore(final String key, final double min, final double max, long offset, long count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;RedisZSetCommands.Tuple&gt; zRangeWithScores(final String key, final double min, final double max, long offset, long count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zRank(final String key, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zRevRank(final String key, final double score, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zRem(final String key, final String value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zMRem(final String key, final List&lt;String&gt; fields);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zRemRangeByScore(final String key, final RedisZSetCommands.Range range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;byte[]&gt; zRangeByLex(final String key, final RedisZSetCommands.Range range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zUnionStore(final String destKey, List&lt;String&gt; sets);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long zInterStore(final String destKey, final byte[]... sets);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;T&gt; Search zSetSearchPage(String key, SortTypeEnum sortTypeEnum, int pageSize, int pageIndex, Class&lt;T&gt; clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-rediscacheserviceimpl">2. RedisCacheServiceImpl<a href="#2-rediscacheserviceimpl" class="hash-link" aria-label="Direct link to 2. RedisCacheServiceImpl" title="Direct link to 2. RedisCacheServiceImpl">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.Gson;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.GsonBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.domain.Search;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.manager.RedisCacheServiceI;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.utils.JsonTool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.weliner.business.config.utils.SortTypeEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.dao.DataAccessException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.connection.RedisConnection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.connection.RedisZSetCommands;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.core.RedisCallback;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.core.RedisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.core.TimeoutUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.serializer.RedisSerializer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.util.Assert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.TimeUnit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.stream.Collectors;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ****.coding@gmail.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RedisCacheServiceImpl implements RedisCacheServiceI {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RedisTemplate redisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;String&gt; keys(String pattern) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;String&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;String&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;byte[]&gt; sets = connection.keys(stringRedisSerializer.serialize(pattern));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;String&gt; keys = new LinkedHashSet&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == sets) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return keys;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sets.forEach(item -&gt; keys.add(stringRedisSerializer.deserialize(item)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return keys;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean exists(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.exists(stringRedisSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean expire(String redisKey, long expire, TimeUnit timeUnit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            long rawTimeout = TimeoutUtils.toMillis(expire, timeUnit);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.pExpire(stringRedisSerializer.serialize(redisKey), rawTimeout);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean setStr(String key, String value, Long timeout) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.setEx(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    timeout,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(value));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long increment(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.incr(stringSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean setStr(String key, String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(value));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getStr(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (String) redisTemplate.execute((RedisCallback&lt;String&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] value = connection.get(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (String) stringSerializer.deserialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; T getStr(String key, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (T) redisTemplate.execute((RedisCallback&lt;T&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] bytes = connection.get(stringRedisSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String json = stringRedisSerializer.deserialize(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == json) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return gson.fromJson(json, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T, R&gt; List&lt;T&gt; mGet(List&lt;R&gt; list, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (List&lt;T&gt;) redisTemplate.execute((RedisCallback&lt;List&lt;T&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[][] bkeys = new byte[list.size()][];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; list.size(); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                bkeys[i] = list.get(i).toString().getBytes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;byte[]&gt; byteList = connection.mGet(bkeys);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;T&gt; result = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; byteList.size(); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result.add(gson.fromJson(stringRedisSerializer.deserialize(byteList.get(i)), clazz));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long del(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.del(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean sIsMember(String key, String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.sIsMember(stringRedisSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringRedisSerializer.serialize(value));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long sCard(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.sCard(stringRedisSerializer.serialize(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean sAdd(String key, String values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Long result = connection.sAdd(stringRedisSerializer.serialize(key), stringRedisSerializer.serialize(values));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == result || result == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean sRem(String key, String values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Long result = connection.sRem(stringRedisSerializer.serialize(key), stringRedisSerializer.serialize(values));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == result || result == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void hSet(String key, Map map) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redisTemplate.execute((RedisCallback) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator = map.entrySet().iterator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String mapKey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;byte[], byte[]&gt; hashes = new LinkedHashMap(map.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (iterator.hasNext()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map.Entry&lt;String, Object&gt; entry = iterator.next();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mapKey = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hashes.put(stringRedisSerializer.serialize(mapKey),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        stringRedisSerializer.serialize(JsonTool.toString(value)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connection.hMSet(stringRedisSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    hashes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object hGet(String key, String hashKey) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return redisTemplate.execute((RedisCallback) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] bytes = connection.hGet(stringRedisSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringRedisSerializer.serialize(hashKey));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return stringRedisSerializer.deserialize(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; List&lt;T&gt; hMGet(String key, List&lt;String&gt; fields, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (List&lt;T&gt;) redisTemplate.execute((RedisCallback&lt;List&lt;T&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[][] bkeys = new byte[fields.size()][];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; fields.size(); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                bkeys[i] = fields.get(i).toString().getBytes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keys = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;byte[]&gt; listByte = connection.hMGet(keys, bkeys);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;T&gt; result = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; listByte.size(); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result.add(gson.fromJson(stringRedisSerializer.deserialize(listByte.get(i)), clazz));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 时间复杂度： O(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 将哈希表 hash 中域 field 的值设置为 value 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如果给定的哈希表并不存在， 那么一个新的哈希表将被创建并执行 HSET 操作。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如果域 field 已经存在于哈希表中， 那么它的旧值将被新值 value 覆盖。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return Boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @Title: hSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean hSet(final String key, final String field, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keys = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] fields = stringRedisSerializer.serialize(field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] values = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.hSet(keys, fields, values);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean hExists(final String key, final String field) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keys = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] fields = stringRedisSerializer.serialize(field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.hExists(keys, fields);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; T hGet(String key, String hashKey, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (T) redisTemplate.execute((RedisCallback&lt;T&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] bytes = connection.hGet(stringRedisSerializer.serialize(key),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stringRedisSerializer.serialize(hashKey));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String json = stringRedisSerializer.deserialize(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null == json) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return gson.fromJson(json, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(M*log(N))， N 是有序集的基数， M 为成功添加的新成员的数量。 将一个或多个 member</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 元素及其 score 值加入到有序集 key 当中。 如果某个 member 已经是有序集的成员，那么更新这个 member 的 score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值，并通过重新插入这个 member 元素，来保证该 member 在正确的位置上。 score 值可以是整数值或双精度浮点数。 如果 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 不存在，则创建一个空的有序集并执行 ZADD 操作。 当 key 存在但不是有序集类型时，返回一个错误。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Boolean zAdd(final String key, final double score, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Boolean zAdd = connection.zAdd(keyByte, score, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (zAdd == false) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 兼容value、score相同的情况也会返回false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Double zScore = connection.zScore(keyByte, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (null != zScore) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return zAdd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zAdd(final String key, Set&lt;RedisZSetCommands.Tuple&gt; tuples) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zAdd(keyByte, tuples);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(1) 返回有序集 key 中，成员 member 的 score 值。 如果 member 元素不是有序集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * key 的成员，或 key 不存在，返回 nil 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Double zScore(final String key, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Double) redisTemplate.execute((RedisCallback&lt;Double&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zScore(keyByte, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(log(N)) 为有序集 key 的成员 member 的 score 值加上增量 increment 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可以通过传递一个负数值 increment ，让 score 减去相应的值，比如 ZINCRBY key -5 member ，就是让 member 的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值减去 5 。 当 key 不存在，或 member 不是 key 的成员时， ZINCRBY key increment member</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 等同于 ZADD key increment member 。 当 key 不是有序集类型时，返回一个错误。 score 值可以是整数值或双精度浮点数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param increment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Double zIncrBy(final String key, final double increment, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Double) redisTemplate.execute((RedisCallback&lt;Double&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zIncrBy(keyByte, increment, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(1) 返回有序集 key 的基数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zCard(final String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute(new RedisCallback&lt;Long&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public Long doInRedis(RedisConnection connection) throws DataAccessException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return connection.zCard(keyByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.0.0 时间复杂度: O(log(N))， N 为有序集的基数。 返回有序集 key 中， score 值在 min 和 max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 之间(默认包括 score 值等于 min 或 max )的成员的数量。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zCount(final String key, final RedisZSetCommands.Range range) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute(new RedisCallback&lt;Long&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public Long doInRedis(RedisConnection connection) throws DataAccessException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return connection.zCount(keyByte, range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; Set&lt;T&gt; zRange(final String key, final long start, final long end, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;T&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;T&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;byte[]&gt; bytes = connection.zRange(keyByte, start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;T&gt; set = new HashSet&lt;&gt;(bytes.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (null != bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Gson gson = new GsonBuilder().disableHtmlEscaping().create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (byte[] b : bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Object value = stringRedisSerializer.deserialize(b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (null != value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        set.add(gson.fromJson(value.toString(), clazz));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return set;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(log(N)+M)， N 为有序集的基数，而 M 为结果集的基数。 返回有序集 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 中，指定区间内的成员。 其中成员的位置按 score 值递增(从小到大)来排序。 具有相同 score 值的成员按字典序(lexicographical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * order )来排列。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRange(final String key, final long start, final long end) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRange(keyByte, start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(log(N)+M)， N 为有序集的基数，而 M 为结果集的基数。 返回有序集 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 中，指定区间内的成员。 其中成员的位置按 score 值递减(从大到小)来排列。 具有相同 score 值的成员按字典序的逆序(reverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * lexicographical order)排列。 除了成员按 score 值递减的次序排列这一点外， ZREVRANGE 命令的其他方面和 ZRANGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * key start stop [WITHSCORES] 命令一样。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRevRange(final String key, final long start, final long end) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRevRange(keyByte, start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.0.5 时间复杂度: O(log(N)+M)， N 为有序集的基数， M 为被结果集的基数。 返回有序集 key 中，所有</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。 具有相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值的成员按字典序(lexicographical order)来排列(该属性是有序集提供的，不需要额外的计算)。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRangeByScore(final String key, final double min, final double max) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRangeByScore(keyByte, min, max);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 根据索引区间获取元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值递增(从小到大)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;RedisZSetCommands.Tuple&gt; zRangeWithScores(final String key, final long start, final long end) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;RedisZSetCommands.Tuple&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;RedisZSetCommands.Tuple&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRangeWithScores(keyByte, start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 根据索引区间获取元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值递增(从大到小)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;RedisZSetCommands.Tuple&gt; zRevRangeWithScores(final String key, final long start, final long end) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;RedisZSetCommands.Tuple&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;RedisZSetCommands.Tuple&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRevRangeWithScores(keyByte, start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.2.0 时间复杂度: O(log(N)+M)， N 为有序集的基数， M 为结果集的基数。 返回有序集 key 中， score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值介于 max 和 min 之间(默认包括等于 max 或 min )的所有的成员。有序集成员按 score 值递减(从大到小)的次序排列。 具有相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值的成员按字典序的逆序(reverse lexicographical order )排列。 除了成员按 score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值递减的次序排列这一点外， ZREVRANGEBYSCORE 命令的其他方面和 ZRANGEBYSCORE key min max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * [WITHSCORES] [LIMIT offset count] 命令一样。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRevRangeByScore(final String key, final double min, final double max) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRevRangeByScore(keyByte, min, max);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.2.0 时间复杂度: O(log(N)+M)， N 为有序集的基数， M 为结果集的基数。 返回有序集 key 中， score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值介于 max 和 min 之间(默认包括等于 max 或 min )的所有的成员。有序集成员按 score 值递减(从大到小)的次序排列。 具有相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值的成员按字典序的逆序(reverse lexicographical order )排列。 除了成员按 score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值递减的次序排列这一点外， ZREVRANGEBYSCORE 命令的其他方面和 ZRANGEBYSCORE key min max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * [WITHSCORES] [LIMIT offset count] 命令一样。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRevRangeByScore(final String key, final double min, final double max, long offset, long count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRevRangeByScore(keyByte, min, max, offset, count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;RedisZSetCommands.Tuple&gt; zRangeWithScores(final String key, final double min, final double max, long offset, long count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;RedisZSetCommands.Tuple&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;RedisZSetCommands.Tuple&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRangeByScoreWithScores(keyByte, min, max, offset, count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.0.0 时间复杂度: O(log(N)) 返回有序集 key 中成员 member 的排名。其中有序集成员按 score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值递增(从小到大)顺序排列。 排名以 0 为底，也就是说， score 值最小的成员排名为 0 。 使用 ZREVRANK key member</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 命令可以获得成员按 score 值递减(从大到小)排列的排名。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zRank(final String key, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRank(keyByte, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.0.0 时间复杂度: O(log(N)) 返回有序集 key 中成员 member 的排名。其中有序集成员按 score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 值递减(从大到小)排序。 排名以 0 为底，也就是说， score 值最大的成员排名为 0 。 使用 ZRANK key member 命令可以获得成员按</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值递增(从小到大)排列的排名。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zRevRank(final String key, final double score, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer&lt;String&gt; stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRevRank(keyByte, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(M*log(N))， N 为有序集的基数， M 为被成功移除的成员的数量。 移除有序集 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 中的一个或多个成员，不存在的成员将被忽略。 当 key 存在但不是有序集类型时，返回一个错误。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zRem(final String key, final String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] valueByte = stringRedisSerializer.serialize(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRem(keyByte, valueByte);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度: O(M*log(N))， N 为有序集的基数， M 为被成功移除的成员的数量。 移除有序集 key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 中的一个或多个成员，不存在的成员将被忽略。 当 key 存在但不是有序集类型时，返回一个错误。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param fields 删除多数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zMRem(final String key, final List&lt;String&gt; fields) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keys = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;byte[]&gt; values = new ArrayList&lt;&gt;(fields.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (String field : fields) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] value = stringRedisSerializer.serialize(field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                values.add(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[][] valueArr = new byte[values.size()][];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRem(keys,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    values.toArray(valueArr));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 1.2.0 时间复杂度： O(log(N)+M)， N 为有序集的基数，而 M 为被移除成员的数量。 移除有序集 key 中，所有</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。 自版本2.1.6开始， score 值等于 min 或 max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 的成员也可以不包括在内，详情请参见 ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 命令。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zRemRangeByScore(final String key, final RedisZSetCommands.Range range) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRemRangeByScore(keyByte, range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.8.9 时间复杂度：O(log(N)+M)， 其中 N 为有序集合的元素数量， 而 M 则是命令返回的元素数量。 如果 M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 是一个常数（比如说，用户总是使用 LIMIT 参数来返回最先的 10 个元素）， 那么命令的复杂度也可以看作是 O(log(N)) 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 当有序集合的所有成员都具有相同的分值时， 有序集合的元素会根据成员的字典序（lexicographical ordering）来进行排序，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 而这个命令则可以返回给定的有序集合键 key 中， 值介于 min 和 max 之间的成员。 如果有序集合里面的成员带有不同的分值，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 那么命令返回的结果是未指定的（unspecified）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Set&lt;byte[]&gt; zRangeByLex(final String key, final RedisZSetCommands.Range range) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Set&lt;byte[]&gt;) redisTemplate.execute((RedisCallback&lt;Set&lt;byte[]&gt;&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] keyByte = stringRedisSerializer.serialize(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zRangeByLex(keyByte, range);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本：&gt;= 2.0.0 时间复杂度: O(N)+O(M log(M))， N 为给定有序集基数的总和， M 为结果集的基数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 计算给定的一个或多个有序集的并集，其中给定 key 的数量必须以 numkeys 参数指定，并将该并集(结果集)储存到 destination 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认情况下，结果集中某个成员的 score 值是所有给定集下该成员 score 值之 和 。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param destKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param sets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zUnionStore(final String destKey, List&lt;String&gt; sets) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] destKeyByte = stringRedisSerializer.serialize(destKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[][] arr = new byte[sets.size()][];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zUnionStore(destKeyByte, sets.parallelStream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .map(val -&gt; stringRedisSerializer.serialize(val)).collect(Collectors.toList()).toArray(arr));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 可用版本： &gt;= 2.0.0 时间复杂度: O(N*K)+O(M*log(M))， N 为给定 key 中基数最小的有序集， K 为给定有序集的数量， M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 为结果集的基数。 计算给定的一个或多个有序集的交集，其中给定 key 的数量必须以 numkeys 参数指定，并将该交集(结果集)储存到</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * destination 。 默认情况下，结果集中某个成员的 score 值是所有给定集下该成员 score 值之和.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param destKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param sets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long zInterStore(final String destKey, final byte[]... sets) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] destKeyByte = stringRedisSerializer.serialize(destKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return connection.zInterStore(destKeyByte, sets);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * zset分页方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key          缓存key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param sortTypeEnum 排序方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param pageSize     分页大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param pageIndex    页码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param clazz        元素类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; Search zSetSearchPage(String key, SortTypeEnum sortTypeEnum, int pageSize, int pageIndex, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Search search = new Search();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        search.setPageIndex(pageIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        search.setPageSize(pageSize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        search.buildPage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (pageSize == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return search;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RedisSerializer stringRedisSerializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                = redisTemplate.getStringSerializer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取总条数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Long totalCount = zCount(key, RedisZSetCommands.Range.unbounded());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 总页数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Long totalPageCount = totalCount / pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Long pageNum = (totalCount % pageSize) == 0 ? totalPageCount : totalPageCount + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断是否需要去执行，当总页数&lt;取数页时不需要去执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (pageNum &gt;= pageIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int offset = search.getOffset();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 与数据库不同，redis从0开始，第二个参数是结束的下标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int endIndex = offset + search.getPageSize() - 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;byte[]&gt; zSetRange = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (sortTypeEnum == SortTypeEnum.DESC) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                zSetRange = zRevRange(key, offset, endIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                zSetRange = zRange(key, offset, endIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;T&gt; list = new HashSet&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            list = (Set&lt;T&gt;) Optional.ofNullable(zSetRange).orElseGet(() -&gt; Collections.emptySet()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ).stream().filter(Objects::nonNull).map(i -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return gson.fromJson((String) stringRedisSerializer.deserialize(i), clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            search.setTotal(totalCount.intValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            search.setResult(Arrays.asList(list));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return search;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/redis">Redis</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/原博客文件/MySQL索引"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MySQL索引</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/原博客文件/ThreadLocal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ThreadLocal</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#摘要" class="table-of-contents__link toc-highlight">摘要</a></li><li><a href="#难点" class="table-of-contents__link toc-highlight">难点</a></li><li><a href="#代码" class="table-of-contents__link toc-highlight">代码</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">相关项目</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://hei.fan/" target="_blank" rel="noopener noreferrer" class="footer__link-item">嘿凡导航<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:heifan@88.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">邮箱<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 HiF, Inc.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.e32c180a.js"></script>
<script src="/en/assets/js/main.3f548347.js"></script>
</body>
</html>