<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-原博客文件/JJWT框架的使用">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">JJWT框架的使用 | HiF.icu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hif.icu/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hif.icu/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hif.icu/jjwt_demo"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="JJWT框架的使用 | HiF.icu"><meta data-rh="true" name="description" content="JWT介绍"><meta data-rh="true" property="og:description" content="JWT介绍"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hif.icu/jjwt_demo"><link data-rh="true" rel="alternate" href="https://hif.icu/jjwt_demo" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://hif.icu/en/jjwt_demo" hreflang="en"><link data-rh="true" rel="alternate" href="https://hif.icu/jjwt_demo" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YC0RIRDJGZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="HiF.icu" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.1160306f.css">
<link rel="preload" href="/assets/js/runtime~main.3c39b337.js" as="script">
<link rel="preload" href="/assets/js/main.c6314140.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HiF</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">嘿凡的文档空间</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/新手问题">新手问题</a><button aria-label="打开/收起侧边栏菜单「新手问题」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/杂乱问题">杂乱问题</a><button aria-label="打开/收起侧边栏菜单「杂乱问题」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/category/原博客文件">原博客文件</a><button aria-label="打开/收起侧边栏菜单「原博客文件」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aop_demo">AopDemo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git_dev">Git开发流程规范</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hutool_validator">HuTool工具类</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/jjwt_demo">JJWT框架的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java_run">Java运行命令解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/leetcode_53">最大子序和_力扣53</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/leetcode_94">二叉树的中序遍历</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/linux">Linux常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mysql_output">MySQL导出注释信息</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mysql_index">MySQL索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/redis_cache_service">Redis工具类封装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/threadlocal">ThreadLocal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gateway">GateWay总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/saas_app_doc">SaaS应用管理文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/原博客文件/【重点】应用开发过程中的注意事项">应用开发过程中的注意事项</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/wx_work_message">企业微信群机器人发送消息</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/base_data_management">基础数据管理之版本管理模块-数据版本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/resist">应该抵制的品牌</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tree_test">数据库单表实现多级子树</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mysql_tips">数据库存储技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website_collect">网址收藏</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hutool_tree">记一次HuTool树操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rearrange">记一次后端处理前端拖拽排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kill_bug_dima">记一次低码平台问题排查</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/factory_pattern">设计模式-工厂模式</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/原博客文件"><span itemprop="name">原博客文件</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">JJWT框架的使用</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>JJWT框架的使用</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jwt介绍">JWT介绍<a href="#jwt介绍" class="hash-link" aria-label="JWT介绍的直接链接" title="JWT介绍的直接链接">​</a></h3><p>JWTs是JSON对象的编码表示。JSON对象由零或多个名称/值对组成，其中名称为字符串，值为任意JSON值。JWT有助于在clear(例如在URL中)发送这样的信息，可以被信任为不可读(即加密的)、不可修改的(即签名)和URL - safe(即Base64编码的)。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用场景">使用场景<a href="#使用场景" class="hash-link" aria-label="使用场景的直接链接" title="使用场景的直接链接">​</a></h4><ul><li><p><strong>Authorization</strong> (授权) ：一旦用户登录，后续每个请求都将包含JWT，允许用户访问该令牌允许的路由、服务和资源。单点登录是现在广泛使用的JWT的一个特性，因为它的开销很小，并且可以轻松地跨域使用。</p></li><li><p><strong>Information Exchange</strong> (信息交换)：对于安全的在各方之间传输信息而言，JSON Web Tokens无疑是一种很好的方式。因为JWTs可以被签名，例如，用公钥/私钥对，你可以确定发送人就是它们所说的那个人。另外，由于签名是使用头和有效负载计算的，您还可以验证内容没有被篡改。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwt的组成">JWT的组成<a href="#jwt的组成" class="hash-link" aria-label="JWT的组成的直接链接" title="JWT的组成的直接链接">​</a></h4><ol><li><p>Header：标题包含了令牌的元数据，并且在最小包含签名和/或加密算法的类型；</p></li><li><p>Claims：Claims包含想要签署的任何信息；</p></li><li><p>JSON Web Signature (JWS)：在Header中指定的使用该算法的数字签名和声明</p></li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Header</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;alg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HS256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;typ&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JWT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Claims</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1234567890&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John Doe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;admin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base64UrlEncode(Header) + </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"> + base64UrlEncode(Claims)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwt的框架jjwt">JWT的框架：JJWT<a href="#jwt的框架jjwt" class="hash-link" aria-label="JWT的框架：JJWT的直接链接" title="JWT的框架：JJWT的直接链接">​</a></h4><p>JJWT是一个提供端到端的JWT创建和验证的Java库。永远免费和开源(Apache License，版本2.0)，JJWT很容易使用和理解。它被设计成一个以建筑为中心的流畅界面，隐藏了它的大部分复杂性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开始上手">开始上手<a href="#开始上手" class="hash-link" aria-label="开始上手的直接链接" title="开始上手的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="demo-jjwt">demo-jjwt<a href="#demo-jjwt" class="hash-link" aria-label="demo-jjwt的直接链接" title="demo-jjwt的直接链接">​</a></h4><ul><li><p>创建maven项目；</p></li><li><p>导入依赖</p></li></ul><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- jjwt  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.jsonwebtoken</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jjwt</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${jjwt.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>JwtUtils</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JwtUtils {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ACCESS_TOKEN_HEADER = &quot;Authorization&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String REFRESH_TOKEN_HEADER = &quot;Refresh-Token&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String TOKEN_PREFIX = &quot;Bearer &quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认的 用户续期时长（时间戳） 7天</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Long DEF_RENEWAL_TIMESTAMP = 7 * 24 * 60 * 60 * 1L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认的 校验时间间隔（时间戳）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Long DEF_CHECK_INTERVAL = 1800L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认的 jwt 过期时间 1天</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Long DEF_EXPIRATION = 24 * 60 * 60 * 1000L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发的密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String SECRET = &quot;demo.jjwt.token&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发单位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String DEF_ISS = &quot;https://www.keaijing.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 令牌用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String U_DATA = &quot;U&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String issueJwt(Long phoneNum) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.notNull(phoneNum, &quot;phoneNum is null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Jwts.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setHeaderParam(&quot;typ&quot;, &quot;JWT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setSubject(phoneNum + &quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuer(DEF_ISS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuedAt(DateUtil.date())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setExpiration(DateUtil.date(System.currentTimeMillis() + DEF_EXPIRATION))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .signWith(SignatureAlgorithm.HS512, SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compact();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 检查是否过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static boolean checkJwtExpiration(String jwt) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Claims claims = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims = Jwts.parser()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setSigningKey(SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .parseClaimsJws(jwt.trim())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == claims) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return claims.getExpiration().before(new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;jwt 过期啦～～～～&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxNzYzMzgyMzk4MSIsImlzcyI6Imh0dHBzOi8vd3d3LmtlYWlqaW5nLmNvbSIsImlhdCI6MTY0NDIyMjAwMSwiZXhwIjoxNjQ0MzA4NDAxfQ.WBX6S1HQZqZtUsjH7XGKlIRWoNCmSSLq7nn24jXSbo4PCTIqSj-Uo6XiEjhda5-Vo91_lhnwSXCb2qVctFNqjQ&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        log.info(issueJwt(17612343344L));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;&quot; + checkJwtExpiration(token));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="进阶操作">进阶操作<a href="#进阶操作" class="hash-link" aria-label="进阶操作的直接链接" title="进阶操作的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwtauthinfo">JwtAuthInfo<a href="#jwtauthinfo" class="hash-link" aria-label="JwtAuthInfo的直接链接" title="JwtAuthInfo的直接链接">​</a></h4><p>在用户Token里存储用户信息，方便解析后直接进行校验。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * jwt用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/2/9 13:49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JwtAuthInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 用户id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String usrId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 用户账号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String accountNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 用户别称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String nickName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 校验时间间隔（时间戳）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long checkInterval;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * jwt 过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long expiration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwtauthmanager">JwtAuthManager<a href="#jwtauthmanager" class="hash-link" aria-label="JwtAuthManager的直接链接" title="JwtAuthManager的直接链接">​</a></h4><p>创建JwtAuthManager用户权限管理类，用于校验Token格式、签发Toekn等操作。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * jwt用户权限管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/2/9 14:03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JwtAuthManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ACCESS_TOKEN_HEADER = &quot;Authorization&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String TOKEN_PREFIX = &quot;Bearer &quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认的 校验时间间隔（时间戳）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Long DEF_CHECK_INTERVAL = 1800L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 默认的 jwt 过期时间 1天</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Long DEF_EXPIRATION = 24 * 60 * 60 * 1L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发的密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String SECRET = &quot;demo.jjwt.token&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发单位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String DEF_ISS = &quot;https://www.keaijing.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 令牌用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String U_DATA = &quot;U&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static JwtAuthInfo getJwtAuthentication(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = getJwt(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return getJwtAuthInfo(token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static String getJwt(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String tokenHeader = request.getHeader(JwtAuthManager.ACCESS_TOKEN_HEADER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tokenHeader == null || !tokenHeader.startsWith(JwtAuthManager.TOKEN_PREFIX)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = tokenHeader.replace(JwtAuthManager.TOKEN_PREFIX, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Strings.isEmpty(token)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return token.trim();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static JwtAuthInfo getJwtAuthInfo(String token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot; header 中未找到 jwt信息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BizException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        token = token.trim();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JwtAuthInfo JwtAuthInfo = JwtAuthInfo(token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == JwtAuthInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot; jwt 解析失败&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BizException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return JwtAuthInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static JwtAuthInfo JwtAuthInfo(String token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Claims claims = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims = Jwts.parser()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setSigningKey(SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .parseClaimsJws(token.trim())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;token 检查失败,无法刷新token。&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj = claims.get(U_DATA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == obj) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return gson.fromJson(obj.toString(), JwtAuthInfo.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 签发token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param userId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param checkInterval</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param expiration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return java.lang.String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @date 2022/2/9 14:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String issueJwt(String userId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  Long checkInterval,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  Long expiration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.notNull(userId, &quot;userId is null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.notNull(checkInterval, &quot;checkInterval is null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.notNull(expiration, &quot;expiration is null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JwtAuthInfo tokenInfo = JwtAuthInfo.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .usrId(userId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .checkInterval(checkInterval)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .expiration(expiration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return issueJwt(tokenInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String issueJwt(JwtAuthInfo JwtAuthInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String u = gson.toJson(JwtAuthInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(U_DATA, u);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Jwts.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .signWith(SignatureAlgorithm.HS512, SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setClaims(map)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuer(DEF_ISS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setSubject(String.valueOf(JwtAuthInfo.getUsrId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuedAt(new Date())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setExpiration(new Date(System.currentTimeMillis() + JwtAuthInfo.getExpiration() * 1000))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compact();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 检查是否过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param jwt true 过期 false未过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static boolean checkJwtExpiration(String jwt) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Claims claims = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims = Jwts.parser()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setSigningKey(SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .parseClaimsJws(jwt.trim())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == claims) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return claims.getExpiration().before(new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;jwt 过期啦～～～～&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String refresh(String token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Claims claims = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims = Jwts.parser()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setSigningKey(SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .parseClaimsJws(token.trim())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;token 检查失败,无法刷新token。&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims.getExpiration().before(new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;jwt 过期啦～～～～&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object u = claims.get(U_DATA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == u) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;jwt 无效 ～～～～&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Gson gson = new Gson();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JwtAuthInfo tokenInfo = gson.fromJson(u.toString(), JwtAuthInfo.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Long expiration = tokenInfo.getExpiration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(U_DATA, u);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Jwts.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .signWith(SignatureAlgorithm.HS512, SECRET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setClaims(map)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuer(DEF_ISS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setSubject(String.valueOf(tokenInfo.getUsrId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setIssuedAt(new Date())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setExpiration(new Date(System.currentTimeMillis() + expiration * 1000))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compact();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 创建默认条件到U_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param usrId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return com.heifan.demo.config.auth.JwtAuthInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @date 2022/2/9 14:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static JwtAuthInfo createJwtAuthInfo(String usrId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return JwtAuthInfo.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .usrId(usrId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .checkInterval(DEF_CHECK_INTERVAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .expiration(DEF_EXPIRATION)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwtauthorizationmanager">JwtAuthorizationManager<a href="#jwtauthorizationmanager" class="hash-link" aria-label="JwtAuthorizationManager的直接链接" title="JwtAuthorizationManager的直接链接">​</a></h4><p>创建jwt认证类，用于校验账号在线状态以及解析Token里的用户信息。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * jwt认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/2/9 14:17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JwtAuthorizationManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ACCOUNT_AUTH_ONLINE_KEY = &quot;demo:jwt:&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RedisCacheServiceI redisCacheService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String authorization(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = getJwt(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return authorization(token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String getJwt(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String tokenHeader = request.getHeader(JwtAuthManager.ACCESS_TOKEN_HEADER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tokenHeader == null || !tokenHeader.startsWith(JwtAuthManager.TOKEN_PREFIX)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = tokenHeader.replace(JwtAuthManager.TOKEN_PREFIX, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Strings.isEmpty(token)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return token.trim();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String authorization(String tokenHeader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = tokenHeader.replace(JwtAuthManager.TOKEN_PREFIX, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JwtAuthInfo jwtAuthInfo = getJwtAuthInfo(token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        online(token, jwtAuthInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return jwtAuthInfo.getAccountNumber();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 校验token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param jwtAuthInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @date 2022/2/9 14:22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void online(String token, JwtAuthInfo jwtAuthInfo){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String cacheKey = ACCOUNT_AUTH_ONLINE_KEY + jwtAuthInfo.getAccountNumber();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String online = redisCacheService.getStr(cacheKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == online) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;账号未登录&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BizException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!online.equals(token)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;账号其他设备登录&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BizException(MessageCodeEnum.USER_OFFLINE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private JwtAuthInfo getJwtAuthInfo(String token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot; header 中未找到 jwt信息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new ParamException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        token = token.trim();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JwtAuthInfo jwtAuthInfo = JwtAuthManager.getJwtAuthInfo(token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null == jwtAuthInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot; jwt 解析失败&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new ParamException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return jwtAuthInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="鉴权思路">鉴权思路<a href="#鉴权思路" class="hash-link" aria-label="鉴权思路的直接链接" title="鉴权思路的直接链接">​</a></h3><ol><li><p>自定义注解；</p></li><li><p>请求进入到切面，获取请求参数，记录请求路径及请求参数；</p></li><li><p>获取方法中声明的注解</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取方法中声明的注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @Author HiF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @Date 2022/2/8 20:42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private MonitorAnnotation getDeclaredAnnotation(JoinPoint joinPoint) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取方法名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String methodName = joinPoint.getSignature().getName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 反射获取目标类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; targetClass = joinPoint.getTarget().getClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 拿到方法对应的参数类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt;[] parameterTypes = ((MethodSignature) joinPoint.getSignature()).getParameterTypes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 根据类、方法、参数类型（重载）获取到方法的具体信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method objMethod = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            objMethod = targetClass.getMethod(methodName, parameterTypes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (NoSuchMethodException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 拿到方法定义的注解信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return objMethod.getDeclaredAnnotation(MonitorAnnotation.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>如果注解鉴权属性为true，则解析用户Token中的信息；</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MonitorAnnotation monitorAnnotation = getDeclaredAnnotation(joinPoint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (null != monitorAnnotation) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (monitorAnnotation.auth()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 如果是http请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (httpRequest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String accountNumber = jwtAuthorizationManager.authorization(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 此处应该校验用户id是否为空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (Validator.isNull(accountNumber)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        throw new ParamException(MessageCodeEnum.NOT_LOGIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/jwt">jwt</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/鉴权">鉴权</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/hutool_validator"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">HuTool工具类</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/java_run"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Java运行命令解析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#jwt介绍" class="table-of-contents__link toc-highlight">JWT介绍</a></li><li><a href="#开始上手" class="table-of-contents__link toc-highlight">开始上手</a></li><li><a href="#进阶操作" class="table-of-contents__link toc-highlight">进阶操作</a></li><li><a href="#鉴权思路" class="table-of-contents__link toc-highlight">鉴权思路</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">相关项目</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://hei.fan/" target="_blank" rel="noopener noreferrer" class="footer__link-item">嘿凡导航<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:heifan@88.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">邮箱<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 HiF, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3c39b337.js"></script>
<script src="/assets/js/main.c6314140.js"></script>
</body>
</html>